#include <iostream>
#include <cstring>
#include "music.h"
#include "media.h"
#include "videogames.h"
#include "movie.h"
#include <vector>
#include <iomanip>

using namespace std;

void add(vector<media*> &s);
void search(vector<media*> &s);
void del(vector<media*> &s);

int main() {
  vector<media*> storage;

  while (true) {
    cout << endl << "'ADD', 'SEARCH', 'DELETE', or 'QUIT'? ";
    char cmd[7];
    cin.getline(cmd, 7);
    if (strcmp(cmd, "ADD") == 0) {
      add(storage);
    }
    else if (strcmp(cmd, "SEARCH") == 0) {
      search(storage);
    }
    else if (strcmp(cmd, "DELETE") == 0) {
      del(storage);
    }
    else if (strcmp(cmd, "QUIT") == 0) {
      break;
    }
    else {
      cout << endl << "Invalid command." << endl;
    }
  }
  
  return 0;
}

void add(vector<media*> &s) {
  char input[3];
  cout << endl << "Add Video Game 'VG', Music 'M', or Movie, 'MV': ";
  cin.getline(input, 3);
  if (strcmp(input, "VG") == 0) {
    videogames* vg = new videogames();
    vg->type = 0;

    cout << "Enter Title: ";
    cin >> vg->title;
    cout << "Enter Year: ";
    cin >> vg->year;
    cout << "Enter Publisher: ";
    cin >> vg->publisher;
    cout << "Enter Rating: ";
    cin >> vg->rating;
    cout << endl;

    s.push_back(vg);
  }
  else if (strcmp(input, "M") == 0) {
    music* m = new music();
    m->type = 1;
    
    cout << "Enter Title: ";
    cin >> m->title;
    cout << "Enter Artist: ";
    cin >> m->artist;
    cout << "Enter Year: ";
    cin >> m->year;
    cout << "Enter Duration: ";
    cin >> m->duration;
    cout << "Enter Publisher: ";
    cin >> m->publisher;
    cout << endl;

    s.push_back(m);
  }
  else if (strcmp(input, "MV") == 0) {
    movie* mv = new movie();
    mv->type = 2;

    cout << "Enter Title: ";
    cin >> mv->title;
    cout << "Enter Director: ";
    cin >> mv->director;
    cout << "Enter Year: ";
    cin >> mv->year;
    cout << "Enter Duration: ";
    cin >> mv->duration;
    cout << "Enter Rating: ";
    cout << endl;

    s.push_back(mv);
  }
}

void search(vector<media*> &s) {
  vector<media*>::iterator it;

  char input2[2];
  cout << "Search by Title 'T' or Year 'Y': ";
  cin.getline(input2, 2);

  if (strcmp(input2, "T") == 0) {
    char input3[80];
    cout << "Enter the Title: ";
    cin.getline(input3, 80);
    for (it = s.begin(); it < s.end(); it++) {
      if (strcmp((*it)->title, input3) == 0) {
	if ((*it)->getType() == 0) {
	  (*it)->print();
	}
	else if ((*it)->getType() == 1) {
	  cout << "Music: " << (*it)->getTitle() << ", " << (*it)->getYear() << endl;
	}
	else if ((*it)->getType() == 2) {
	  cout << "Movie: " << (*it)->getTitle() << ", " << (*it)->getYear() << endl;
	}
      }
    }
  }
  else if (strcmp(input2, "Y") == 0) {
    int input4;
    cout << "Enter the Year: ";
    cin >> input4;
    for (it = s.begin(); it < s.end(); it++) {
      if ((*it)->year == input4) {
        if ((*it)->getType() == 0) {
	  cout << "Videogame: " << (*it)->getTitle() << ", " << (*it)->getYear() << endl;
        }
        else if ((*it)->getType() == 1) {
          cout << "Music: " << (*it)->getTitle() << ", " << (*it)->getYear() << endl;
        }
        else if ((*it)->getType() == 2) {
	  cout << "Movie: " << (*it)->getTitle() << ", " << (*it)->getYear() << endl;
        }
      }
    }

  }
}

void del(vector<media*> &s) {
  vector<media*>::iterator it;

  char input5[80];
  cout << "Enter the Title to delete: ";
  cin.getline(input5, 80);

  char input6[2];
  cout << "Would you like to delete the following?" << endl;
  for (it = s.begin(); it < s.end(); it++) {
    if (strcmp((*it)->title, input5) == 0) {
      if ((*it)->getType() == 0) {
        cout << "Videogame: " << (*it)->getTitle() << ", " << (*it)->getYear() << endl;
      }
      else if ((*it)->getType() == 1) {
        cout << "Music: " << (*it)->getTitle() << ", " << (*it)->getYear() << endl;
      }
      else if ((*it)->getType() == 2) {
        cout << "Movie: " << (*it)->getTitle() << ", " << (*it)->getYear() << endl;
      }

      cout << "Yes 'Y' or No 'N': ";
      cin.getline(input6, 2);
      if (strcmp(input6, "Y") == 0) {
	delete (*it);
	s.erase(it);
      }
    }
  }
}
